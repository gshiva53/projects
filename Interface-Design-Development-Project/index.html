<!DOCTYPE html>
<html lang="en">

<head>
    <title>
        NASA APOD API
    </title>
    <!-- Metadata -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body>
    <!-- Vue.js app -->
    <div id="app">
        <div class="container">
            <!-- Row 1 -->
            <div class="row">
                <div class="col-sm-12 border border-primary">
                    <h1>{{ apodResult.title }}</h1>
                </div>
            </div>
            <!-- Row 2 -->
            <div class="row">
                <p v-if="showEntryMessage">{{ entryMessage }}</p>
                <div class="input-group input-group-sm mb-3 mt-2">
                    <span class="input-group-text" id="inputGroup-sizing-sm">Date</span>
                    <input type="date" class="form-control" v-model="inputDate" @input="apiFetch(apiKey, inputDate)" />
                    <!-- Debug -->
                    <!-- <p>{{ inputDate }}</p> -->
                </div>
            </div>
            <!-- Row 3 -->
            <div class="row">
                <!-- Row 3.1 -->
                <div class="row">
                    <div class="col-sm-4 border border-warning">
                        <!-- IF the error object does not contain an error object then show the result -->
                        <div v-if="error && !(error.error)">
                            <h6>{{ apodResult.date }}</h6>
                            <p>{{ apodResult.explanation }}</p>
                        </div>
                    </div>
                    <div class="col-sm-8 border border-danger">
                        <div class="d-flex align-items-center">
                            <div class="flex-grow-1 p-3">
                                <a :href="apodResult.hdurl">
                                    <img :src="apodResult.url" :alt="apodResult.title" class="img-fluid p-2 rounded">
                                </a>
                            </div>
                        </div>
                        <!-- Display the image which links to the HD image -->
                    </div>
                </div>
                <!-- Footer containing additional information and messages -->
                <div class="col-sm-12 border border-secondary">
                    <!-- IF error exists then it can either be the result or the error message -->
                    <div v-if="error">
                        <!-- IF error.error exists then it is definitely the error with the error code and message -->
                        <div v-if="error.error">
                            <strong>
                                <p>{{ error.error.code }}</p>
                            </strong>
                            <p>{{ error.error.message }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Vue.js plug-ins -->
    <script src="https://unpkg.com/vue@3"></script>
    <script>
        const app = {
            data() {
                return {
                    entryMessage: "Please enter a date to show the API Result",
                    showEntryMessage: false,
                    apiKey: "tARTT0OeCAkt3TOHCOyvc6D2ZINWIbe86yOvKHa2",
                    inputDate: null,
                    apodResult: {},
                    apodResults: [],
                    error: null,
                }
            },
            methods: {
                apiFetch(apiKey, inputDate) {
                    if (this.inputDate == null) {
                        currentDateAsInput()
                    } else {
                        fetch("https://api.nasa.gov/planetary/apod?" +
                            "api_key=" + apiKey + "&date=" + inputDate)
                            .then(response => response.json())
                            .then(data => this.apodResult = data)
                            .then(error => {
                                //error.error contains the error code and the error message
                                this.error = error
                                console.log(error)
                            })
                    }
                }
            },
            computed: {
                currentDateAsInput() {
                    this.inputDate = new Date().toJSON().slice(0, 10)
                    console.log(this.inputDate)
                }
            }
        }

        Vue.createApp(app)
            .mount("#app")
    </script>
</body>

</html>